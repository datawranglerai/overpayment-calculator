<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mortgage Overpayment Calculator</title>
    <link rel="icon" type="image/png" href="/favicon.ico/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.ico/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico/apple-touch-icon.png" />
    <link rel="manifest" href="/favicon.ico/site.webmanifest" />
    <style>
        :root {
            --primary-color: #4361ee; /* Electric blue */
            --secondary-color: #3a0ca3; /* Deep purple */
            --accent-color: #f72585; /* Vibrant pink */
            --neutral-color: #f8f9fa;
            --background-color: #e6e7ee; /* Light gray background for neumorphism */
            --card-color: #e6e7ee; /* Same as background for neumorphism */
            --text-color: #2b2d42; /* Dark text */
            --text-light: #6c757d; /* Light text */
            --success-color: #4cc9f0; /* Bright cyan */
            --border-radius: 16px;
            --box-shadow-neumorphic: 8px 8px 16px #c8c9d8, -8px -8px 16px #ffffff;
            --box-shadow-neumorphic-inset: inset 5px 5px 10px #c8c9d8, inset -5px -5px 10px #ffffff;
            --box-shadow-pressed: 3px 3px 6px #c8c9d8, -3px -3px 6px #ffffff;
            --transition-default: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: var(--transition-default);
        }
        
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-neumorphic);
            background-color: var(--card-color);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.2), rgba(76, 201, 240, 0.1));
            z-index: 0;
        }
        
        header h1, header .subtitle {
            position: relative;
            z-index: 1;
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            color: var(--text-light);
            font-size: 1.2rem;
        }
        
        .calculator-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .input-section, .results-section {
            flex: 1;
            min-width: 300px;
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow-neumorphic);
        }
        
        h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-weight: 600;
            position: relative;
            padding-bottom: 10px;
        }
        
        h2::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 50px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 3px;
        }
        
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
            transition: transform 0.3s ease;
        }
        
        input, select {
            width: 100%;
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            /* background-color: var(--card-color); */
            background-color: #ffffff;
            color: var(--text-color);
            box-shadow: var(--box-shadow-neumorphic-inset);
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            box-shadow: var(--box-shadow-neumorphic-inset), 0 0 0 3px rgba(67, 97, 238, 0.3);
            transform: scale(1.02);
        }
        
        .input-group {
            display: flex;
            gap: 10px;
        }
        
        .input-group input {
            flex: 1;
        }
        
        button {
            background: var(--primary-color);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            box-shadow: var(--box-shadow-neumorphic);
            position: relative;
            overflow: hidden;
            z-index: 1;
            letter-spacing: 0.5px;
        }
        
        button::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: all 0.5s ease;
            z-index: -1;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 14px rgba(0, 0, 0, 0.1), 0 3px 6px rgba(0, 0, 0, 0.08);
        }
        
        button:hover::before {
            left: 100%;
        }
        
        button:active {
            transform: translateY(1px);
            box-shadow: var(--box-shadow-pressed);
        }
        
        .result-card {
            background-color: var(--card-color);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: var(--box-shadow-neumorphic);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .result-card::before {
            content: "";
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 5px;
            background: linear-gradient(180deg, var(--primary-color), var(--secondary-color));
            border-radius: 4px 0 0 4px;
        }
        
        .result-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .result-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .result-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-color);
            margin: 5px 0;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            opacity: 0;
            transform: translateY(10px);
            animation: fadeInUp 0.5s forwards;
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .result-subtitle {
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .comparison-section {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .comparison-card {
            flex: 1;
            background-color: var(--card-color);
            border-radius: 12px;
            padding: 15px;
            box-shadow: var(--box-shadow-neumorphic);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        
        .comparison-card:hover {
            transform: translateY(-3px);
        }
        
        .comparison-card::before {
            content: "";
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 5px;
            background: var(--secondary-color);
            border-radius: 4px 0 0 4px;
        }
        
        .savings-highlight {
            color: var(--accent-color);
            font-weight: 700;
            position: relative;
            display: inline-block;
        }
        
        .savings-highlight::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--accent-color);
            transform: scaleX(0);
            transform-origin: right;
            transition: transform 0.3s ease;
        }
        
        .savings-highlight:hover::after {
            transform: scaleX(1);
            transform-origin: left;
        }
        
        .chart-container {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow-neumorphic);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            width: 100%;
            box-sizing: border-box;
        }

        .chart-canvas-wrapper {
            position: relative;
            height: 350px;
            width: 100%;
            margin-top: 15px;
            /* background-color: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            box-shadow: var(--box-shadow-neumorphic-inset); */
            padding: 10px;
        }
        
        canvas {
            max-height: 350px !important;
            width: 100% !important;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.7);
            box-shadow: var(--box-shadow-neumorphic-inset);
            padding: 10px;
            box-sizing: border-box; /* Ensures padding is included in element size */
        }

        /* canvas {
            width: 100% !important;
            height: 100% !important;
            box-sizing: border-box;
        } */
        
        .info-section {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow-neumorphic);
            position: relative;
            overflow: hidden;
            width: 100%;
            box-sizing: border-box;
        }
        
        .info-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));
        }
        
        .info-section h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .info-section p {
            margin-bottom: 15px;
            line-height: 1.7;
        }
        
        .tip {
            background-color: #ffffff;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: var(--box-shadow-neumorphic-inset);
            position: relative;
            border-left: 4px solid var(--accent-color);
        }
        
        .tip-title {
            font-weight: 600;
            color: var(--accent-color);
            margin-bottom: 5px;
        }
        
        .progress-bar {
            height: 6px;
            background-color: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 10px;
            box-shadow: var(--box-shadow-neumorphic-inset);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            width: 0%;
            transition: width 1.5s cubic-bezier(0.165, 0.84, 0.44, 1);
            border-radius: 3px;
        }
        
        .loading {
            position: relative;
        }
        
        .loading::after {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            right: 15px;
            margin-top: -10px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .loading.active::after {
            opacity: 1;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(247, 37, 133, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(247, 37, 133, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(247, 37, 133, 0);
            }
        }
        
        @media (max-width: 768px) {
            .calculator-container {
                flex-direction: column;
            }
            
            .comparison-section {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Reduce My Term</h1>
            <p class="subtitle">See how much time and money you could save with regular mortgage overpayments</p>
        </header>
        
        <div class="calculator-container">
            <div class="input-section">
                <h2>Mortgage Details</h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="calculation-progress"></div>
                </div>
                <form id="mortgage-form">
                    <div class="form-group">
                        <label for="original-amount">Original Mortgage Amount (£)</label>
                        <input type="number" id="original-amount" min="1000" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="remaining-amount">Remaining Balance (£)</label>
                        <input type="number" id="remaining-amount" min="1000" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="interest-rate">Current Interest Rate (%)</label>
                        <input type="number" id="interest-rate" min="0.1" max="20" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="term-years">Original Term (Years)</label>
                        <input type="number" id="term-years" min="1" max="40" step="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Time Already Paid</label>
                        <div class="input-group">
                            <input type="number" id="years-paid" min="0" max="40" step="1" placeholder="Years">
                            <input type="number" id="months-paid" min="0" max="11" step="1" placeholder="Months">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="monthly-overpayment">Monthly Overpayment (£)</label>
                        <input type="number" id="monthly-overpayment" min="0" step="10" required>
                    </div>
                    
                    <button type="submit" id="calculate-btn" class="pulse">Calculate Savings</button>
                </form>
            </div>
            
            <div class="results-section">
                <h2>Your Results</h2>
                <div id="results-container">
                    <p>Enter your mortgage details to see potential savings.</p>
                </div>
            </div>
        </div>
        
        <div class="chart-container">
            <h2>Payment Comparison</h2>
            <div class="chart-canvas-wrapper">
                <canvas id="payment-chart"></canvas>
            </div>
        </div>
        
        <div class="info-section">
            <h2>About Mortgage Overpayments</h2>
            <p>Making overpayments on your mortgage can significantly reduce the total interest you pay and help you become mortgage-free sooner. Even small regular overpayments can make a big difference over time.</p>
            
            <div class="tip">
                <p class="tip-title">Important Note</p>
                <p>Before making overpayments, check with your lender about any potential early repayment charges or overpayment limits on your mortgage.</p>
            </div>
            
            <p>This calculator helps you understand the potential benefits of making regular overpayments on your mortgage. It shows you:</p>
            <ul>
                <li>How much time you could save off your mortgage term</li>
                <li>How much interest you could save over the life of your mortgage</li>
                <li>The difference in your total repayment amount</li>
            </ul>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // DOM elements
        const mortgageForm = document.getElementById('mortgage-form');
        const resultsContainer = document.getElementById('results-container');
        const calculateBtn = document.getElementById('calculate-btn');
        const progressBar = document.getElementById('calculation-progress');
        let paymentChart = null;

        // Add input animation
        const inputs = document.querySelectorAll('input');
        inputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.parentElement.querySelector('label').style.color = 'var(--accent-color)';
                this.style.transform = 'scale(1.02)';
            });
            
            input.addEventListener('blur', function() {
                this.parentElement.querySelector('label').style.color = 'var(--primary-color)';
                this.style.transform = 'scale(1)';
            });
        });

        // Remove pulse effect after first interaction
        document.addEventListener('click', function() {
            calculateBtn.classList.remove('pulse');
        }, { once: true });

        // Calculate monthly payment
        function calculateMonthlyPayment(principal, annualRate, years) {
            const monthlyRate = annualRate / 100 / 12;
            const numPayments = years * 12;
            
            if (monthlyRate === 0) {
                return principal / numPayments;
            }
            
            return principal * monthlyRate * Math.pow(1 + monthlyRate, numPayments) / 
                   (Math.pow(1 + monthlyRate, numPayments) - 1);
        }

        // Calculate mortgage amortization with and without overpayments
        function calculateAmortization(remainingBalance, annualRate, remainingYears, monthlyOverpayment) {
            const monthlyRate = annualRate / 100 / 12;
            const numRemainingPayments = remainingYears * 12;
            const regularMonthlyPayment = calculateMonthlyPayment(remainingBalance, annualRate, remainingYears);
            
            // Standard payment schedule
            let standardSchedule = [];
            let balance = remainingBalance;
            let totalInterestStandard = 0;
            
            for (let i = 0; i < numRemainingPayments; i++) {
                const interestPayment = balance * monthlyRate;
                const principalPayment = regularMonthlyPayment - interestPayment;
                
                totalInterestStandard += interestPayment;
                balance -= principalPayment;
                
                if (i % 12 === 0) {
                    standardSchedule.push({
                        year: i / 12,
                        balance: balance > 0 ? balance : 0
                    });
                }
            }
            
            // With overpayments
            let overpaymentSchedule = [];
            balance = remainingBalance;
            let totalInterestOverpayment = 0;
            let monthsWithOverpayment = 0;
            
            while (balance > 0) {
                const interestPayment = balance * monthlyRate;
                let principalPayment = regularMonthlyPayment - interestPayment;
                
                // Add overpayment
                principalPayment += monthlyOverpayment;
                
                totalInterestOverpayment += interestPayment;
                balance -= principalPayment;
                
                if (balance <= 0) {
                    balance = 0;
                }
                
                monthsWithOverpayment++;
                
                if (monthsWithOverpayment % 12 === 0 || balance <= 0) {
                    overpaymentSchedule.push({
                        year: monthsWithOverpayment / 12,
                        balance: balance
                    });
                }
            }
            
            return {
                standardSchedule,
                overpaymentSchedule,
                regularMonthlyPayment,
                totalInterestStandard,
                totalInterestOverpayment,
                yearsWithOverpayment: monthsWithOverpayment / 12,
                yearsSaved: remainingYears - (monthsWithOverpayment / 12),
                interestSaved: totalInterestStandard - totalInterestOverpayment
            };
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-GB', { 
                style: 'currency', 
                currency: 'GBP',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        // Animate value
        function animateValue(element, start, end, duration, formatter = (val) => val) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const currentValue = Math.floor(progress * (end - start) + start);
                element.innerHTML = formatter(currentValue);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        // Format years and months
        function formatYearsMonths(years) {
            const wholeYears = Math.floor(years);
            const months = Math.round((years - wholeYears) * 12);
            
            if (wholeYears === 0) {
                return months === 1 ? "1 month" : `${months} months`;
            } else if (months === 0) {
                return wholeYears === 1 ? "1 year" : `${wholeYears} years`;
            } else {
                const yearText = wholeYears === 1 ? "1 year" : `${wholeYears} years`;
                const monthText = months === 1 ? "1 month" : `${months} months`;
                return `${yearText} and ${monthText}`;
            }
        }

        // Update chart
        function updateChart(standardSchedule, overpaymentSchedule) {
            const canvas = document.getElementById('payment-chart');
            const ctx = canvas.getContext('2d');
            
            // Destroy existing chart if it exists
            if (paymentChart) {
                paymentChart.destroy();
            }

            // Reset canvas dimensions to prevent growth
            canvas.height = '';
            canvas.width = '';
            
            // Prepare data for chart
            const labels = [];
            const standardData = [];
            const overpaymentData = [];
            
            // Find the maximum number of years in either schedule
            const maxYears = Math.max(
                standardSchedule[standardSchedule.length - 1].year,
                overpaymentSchedule[overpaymentSchedule.length - 1].year
            );
            
            // Create data points for each year
            for (let year = 0; year <= Math.ceil(maxYears); year++) {
                labels.push(`Year ${year}`);
                
                // Find standard balance for this year
                const standardPoint = standardSchedule.find(point => Math.floor(point.year) === year);
                standardData.push(standardPoint ? standardPoint.balance : 0);
                
                // Find overpayment balance for this year
                const overpaymentPoint = overpaymentSchedule.find(point => Math.floor(point.year) === year);
                overpaymentData.push(overpaymentPoint ? overpaymentPoint.balance : 0);
            }

            // Create optimized chart with new colors
            paymentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Standard Repayment',
                            data: standardData,
                            borderColor: '#4361ee',
                            backgroundColor: 'rgba(67, 97, 238, 0.2)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#4361ee',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'With Overpayments',
                            data: overpaymentData,
                            borderColor: '#f72585',
                            backgroundColor: 'rgba(247, 37, 133, 0.2)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#f72585',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    animation: {
                        duration: 1500,
                        easing: 'easeOutQuart'
                    },
                    layout: {
                        padding: {
                            top: 10,
                            right: 20,
                            bottom: 20,
                            left: 10
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                padding: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#2b2d42',
                            bodyColor: '#2b2d42',
                            titleFont: {
                                size: 14,
                                weight: 'bold'
                            },
                            bodyFont: {
                                size: 14
                            },
                            padding: 12,
                            borderColor: 'rgba(0, 0, 0, 0.1)',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatCurrency(context.raw);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)',
                                lineWidth: 1
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                },
                                font: {
                                    size: 12
                                },
                                padding: 10
                            },
                            title: {
                                display: true,
                                text: 'Remaining Balance',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                padding: 10
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)',
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 12
                                },
                                padding: 10,
                                maxRotation: 45, // Angle the labels to save space
                                autoSkip: true,   // Skip labels that would overlap
                                autoSkipPadding: 10 // Ensure minimum spacing between labels
                            },
                            title: {
                                display: true,
                                text: 'Years',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                padding: 10
                            }
                        }
                    }
                }
            });
        }

        // Handle form submission with animation
        mortgageForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Add loading state
            calculateBtn.classList.add('loading', 'active');
            progressBar.style.width = '0%';
            
            // Animate progress bar
            setTimeout(() => {
                progressBar.style.width = '30%';
            }, 100);
            
            setTimeout(() => {
                progressBar.style.width = '70%';
            }, 500);
            
            // Get form values
            const originalAmount = parseFloat(document.getElementById('original-amount').value);
            const remainingAmount = parseFloat(document.getElementById('remaining-amount').value);
            const interestRate = parseFloat(document.getElementById('interest-rate').value);
            const termYears = parseInt(document.getElementById('term-years').value);
            const yearsPaid = parseFloat(document.getElementById('years-paid').value) || 0;
            const monthsPaid = parseFloat(document.getElementById('months-paid').value) || 0;
            const totalYearsPaid = yearsPaid + (monthsPaid / 12);
            const monthlyOverpayment = parseFloat(document.getElementById('monthly-overpayment').value);
            
            // Simulate calculation delay
            setTimeout(() => {
                // Validate inputs
                if (remainingAmount > originalAmount) {
                    alert('Remaining balance cannot be greater than the original mortgage amount.');
                    calculateBtn.classList.remove('loading', 'active');
                    progressBar.style.width = '0%';
                    return;
                }
                
                if (totalYearsPaid >= termYears) {
                    alert('Years already paid cannot be greater than or equal to the original term.');
                    calculateBtn.classList.remove('loading', 'active');
                    progressBar.style.width = '0%';
                    return;
                }
                
                // Calculate remaining term
                const remainingYears = termYears - totalYearsPaid;
                
                // Calculate results
                const results = calculateAmortization(
                    remainingAmount,
                    interestRate,
                    remainingYears,
                    monthlyOverpayment
                );
                
                // Complete progress bar
                progressBar.style.width = '100%';
                
                // Update results display
                resultsContainer.innerHTML = `
                    <div class="result-card">
                        <div class="result-title">Standard Monthly Payment</div>
                        <div class="result-value" id="standard-payment">£0</div>
                        <div class="result-subtitle">Your current monthly payment</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-title">New Monthly Payment</div>
                        <div class="result-value" id="new-payment">£0</div>
                        <div class="result-subtitle">With your overpayment</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-title">Time Saved</div>
                        <div class="result-value" id="time-saved">${formatYearsMonths(results.yearsSaved)}</div>
                        <div class="result-subtitle">You'll be mortgage-free earlier</div>
                    </div>
                    
                    <div class="comparison-section">
                        <div class="comparison-card">
                            <div class="result-title">Standard Repayment</div>
                            <p>Time to pay off: ${formatYearsMonths(remainingYears)}</p>
                            <p>Total interest: <span id="standard-interest">£0</span></p>
                            <p>Total cost: <span id="standard-cost">£0</span></p>
                        </div>
                        
                        <div class="comparison-card">
                            <div class="result-title">With Overpayments</div>
                            <p>Time to pay off: ${formatYearsMonths(results.yearsWithOverpayment)}</p>
                            <p>Total interest: <span id="overpayment-interest">£0</span></p>
                            <p>Total cost: <span id="overpayment-cost">£0</span></p>
                        </div>
                    </div>
                    
                    <div class="result-card" style="margin-top: 20px;">
                        <div class="result-title">Total Interest Saved</div>
                        <div class="result-value savings-highlight" id="interest-saved">£0</div>
                    </div>
                `;
                
                // Animate values with delay
                setTimeout(() => {
                    // Animate the monetary values
                    animateValue(
                        document.getElementById('standard-payment'), 
                        0, 
                        Math.round(results.regularMonthlyPayment), 
                        1000, 
                        formatCurrency
                    );
                    
                    animateValue(
                        document.getElementById('new-payment'), 
                        0, 
                        Math.round(results.regularMonthlyPayment + monthlyOverpayment), 
                        1000, 
                        formatCurrency
                    );
                    
                    animateValue(
                        document.getElementById('standard-interest'), 
                        0, 
                        Math.round(results.totalInterestStandard), 
                        1500, 
                        formatCurrency
                    );
                    
                    animateValue(
                        document.getElementById('overpayment-interest'), 
                        0, 
                        Math.round(results.totalInterestOverpayment), 
                        1500, 
                        formatCurrency
                    );
                    
                    animateValue(
                        document.getElementById('standard-cost'), 
                        0, 
                        Math.round(remainingAmount + results.totalInterestStandard), 
                        1500, 
                        formatCurrency
                    );
                    
                    animateValue(
                        document.getElementById('overpayment-cost'), 
                        0, 
                        Math.round(remainingAmount + results.totalInterestOverpayment), 
                        1500, 
                        formatCurrency
                    );
                    
                    animateValue(
                        document.getElementById('interest-saved'), 
                        0, 
                        Math.round(results.interestSaved), 
                        2000, 
                        formatCurrency
                    );
                    
                    // Update chart
                    updateChart(results.standardSchedule, results.overpaymentSchedule);
                    
                    // Save calculation to localStorage
                    saveCalculation({
                        originalAmount,
                        remainingAmount,
                        interestRate,
                        termYears,
                        yearsPaid: totalYearsPaid,
                        monthlyOverpayment,
                        results: {
                            yearsSaved: results.yearsSaved,
                            interestSaved: results.interestSaved,
                            newPayoffTime: results.yearsWithOverpayment
                        },
                        date: new Date().toISOString()
                    });
                    
                    // Remove loading state
                    calculateBtn.classList.remove('loading', 'active');
                }, 700);
                
            }, 1000);
        });

        // Save calculation to localStorage
        function saveCalculation(calculation) {
            let savedCalculations = JSON.parse(localStorage.getItem('mortgageCalculations') || '[]');
            savedCalculations.push(calculation);
            
            // Keep only the last 10 calculations
            if (savedCalculations.length > 10) {
                savedCalculations = savedCalculations.slice(-10);
            }
            
            localStorage.setItem('mortgageCalculations', JSON.stringify(savedCalculations));
        }

        // Pre-fill form with sample data
        document.getElementById('original-amount').value = "250000";
        document.getElementById('remaining-amount').value = "200000";
        document.getElementById('interest-rate').value = "3.5";
        document.getElementById('term-years').value = "25";
        document.getElementById('years-paid').value = "5";
        document.getElementById('months-paid').value = "0";
        document.getElementById('monthly-overpayment').value = "200";
    </script>
</body>
</html>
